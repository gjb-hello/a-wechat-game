{"version":3,"sources":["assets\\scipts\\joystick.js"],"names":["Common","require","JoystickBG","cc","Class","Component","properties","dot","type","Node","displayName","ring","stickX","stickY","touchType","TouchType","DEFAULT","directionType","DirectionType","ALL","sprite","_stickPos","_touchLocation","onLoad","_createStickSprite","FOLLOW","_initTouchEvent","node","setPosition","self","on","EventType","TOUCH_START","_touchStartEvent","TOUCH_MOVE","_touchMoveEvent","TOUCH_END","_touchEndEvent","TOUCH_CANCEL","event","getLocation","touchPos","convertToNodeSpaceAR","x","y","distance","_getDistance","Vec2","radius","width","posX","posY","Math","cos","_getRadian","sin","_getAngle","_setSpeed","getPosition","_speed"],"mappings":"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","sourceRoot":"/","sourcesContent":["var Common = require('joystickcommon');\r\nvar JoystickBG = require('joystickbg');\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        dot: {\r\n            default: null,\r\n            type: cc.Node,\r\n            displayName: 'dot',\r\n        },\r\n        ring: {\r\n            default: null,\r\n            type: JoystickBG,\r\n            displayName: 'ring',\r\n        },\r\n        stickX: {\r\n            default: 0,\r\n            displayName: 'dotx',\r\n        },\r\n\r\n        stickY: {\r\n            default: 0,\r\n            displayName: 'doty',\r\n        },\r\n        touchType: {\r\n            default: Common.TouchType.DEFAULT,\r\n            type: Common.TouchType,\r\n            displayName: 'touchtype',\r\n        },\r\n        directionType: {\r\n            default: Common.DirectionType.ALL,\r\n            type: Common.DirectionType,\r\n            displayName: 'directionType',\r\n\r\n        },\r\n        sprite: {\r\n            default: null,\r\n            type: cc.Node,\r\n            displayName: 'control_player',\r\n            //���ݵ�Ŀ��\r\n\r\n        },\r\n\r\n        _stickPos: {\r\n            default: null,\r\n            type: cc.Node,\r\n            displayName: 'ҡ�˵�ǰλ��',\r\n        },\r\n\r\n        _touchLocation: {\r\n            default: null,\r\n            type: cc.Node,\r\n            displayName: 'ҡ�˵�ǰλ��',\r\n\r\n        }\r\n    },\r\n\r\n    onLoad: function () {\r\n        this._createStickSprite();\r\n        //����������ΪFOLLOW���ڴ˶�ԲȦ�Ĵ�������\r\n        if(this.touchType == Common.TouchType.FOLLOW){\r\n            this._initTouchEvent();\r\n        }\r\n    },\r\n\r\n    _createStickSprite: function()\r\n    {\r\n        //����ҡ�˵�λ��\r\n        this.ring.node.setPosition(this.stickX, this.stickY);\r\n        this.dot.setPosition(this.stickX, this.stickY);\r\n    },\r\n\r\n    _initTouchEvent: function()\r\n    {\r\n        var self = this;\r\n\r\n        self.node.on(cc.Node.EventType.TOUCH_START, self._touchStartEvent, self);\r\n\r\n        self.node.on(cc.Node.EventType.TOUCH_MOVE, self._touchMoveEvent, self);\r\n\r\n        // ������ԲȦ���뿪����ԲȦ���뿪��ҡ�˹�λ��player�ٶ�Ϊ0\r\n        self.node.on(cc.Node.EventType.TOUCH_END, self._touchEndEvent,self);\r\n        self.node.on(cc.Node.EventType.TOUCH_CANCEL, self._touchEndEvent,self);\r\n\r\n\r\n    },\r\n\r\n    _touchStartEvent: function(event) {\r\n        // ��¼�������������꣬��touch moveʹ��\r\n        this._touchLocation = event.getLocation();\r\n        var touchPos = this.node.convertToNodeSpaceAR(event.getLocation());\r\n        // ����ҡ�˵�λ��\r\n        this.ring.node.setPosition(touchPos);\r\n        this.dot.setPosition(touchPos);\r\n        // ��¼ҡ��λ�ã���touch moveʹ��\r\n        this._stickPos = touchPos;\r\n    },\r\n\r\n    _touchMoveEvent: function(event) {\r\n\r\n        // ���touch startλ�ú�touch move��ͬ����ֹ�ƶ�\r\n        if (this._touchLocation.x == event.getLocation().x && this._touchLocation.y == event.getLocation().y){\r\n            return false;\r\n        }\r\n        // ��ԲȦΪê���ȡ��������\r\n        var touchPos = this.ring.node.convertToNodeSpaceAR(event.getLocation());\r\n        var distance = this.ring._getDistance(touchPos,cc.Vec2(0,0));\r\n        var radius = this.ring.node.width / 2;\r\n\r\n        // ����ҡ�˵�postion���Ը��ڵ�Ϊê�㣬���Զ�λҪ����touch startʱ��λ��\r\n        var posX = this._stickPos.x + touchPos.x;\r\n        var posY = this._stickPos.y + touchPos.y;\r\n        if(radius > distance)\r\n        {\r\n            this.dot.setPosition(cc.Vec2(posX, posY));\r\n        }\r\n        else\r\n        {\r\n            //�ظ���Զ������Ȧ�ڣ�����Ȧ�ڸ��津�����½Ƕ�\r\n            var x = this._stickPos.x + Math.cos(this.ring._getRadian(cc.Vec2(posX,posY))) * radius;\r\n            var y = this._stickPos.y + Math.sin(this.ring._getRadian(cc.Vec2(posX,posY))) * radius;\r\n            this.dot.setPosition(cc.Vec2(x, y));\r\n        }\r\n        //���½Ƕ�\r\n        this.ring._getAngle(cc.Vec2(posX,posY));\r\n        //����ʵ���ٶ�\r\n        this.ring._setSpeed(cc.Vec2(posX,posY));\r\n    },\r\n\r\n    _touchEndEvent: function(){\r\n        this.dot.setPosition(this.ring.node.getPosition());\r\n        this.ring._speed = 0;\r\n    },\r\n\r\n});\r\n"]}