
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scipts/joystickbg.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '406ea/mY8hC2q023CvluCc2', 'joystickbg');
// scipts/joystickbg.js

"use strict";

var Common = require('joystickcommon');

cc.Class({
  "extends": cc.Component,
  properties: {
    dot: {
      "default": null,
      type: cc.Node,
      displayName: 'dot'
    },
    _joyCom: {
      "default": null,
      displayName: 'joy Node'
    },
    _playerNode: {
      "default": null,
      displayName: '��������Ŀ��Node'
    },
    _angle: {
      "default": null,
      displayName: '��ǰ�����ĽǶ�'
    },
    _radian: {
      "default": null,
      displayName: '����'
    },
    _speed: 0,
    //ʵ���ٶ�
    _speed1: 1,
    //һ���ٶ�
    _speed2: 2,
    //�����ٶ�
    _opacity: 0 //͸����

  },
  onLoad: function onLoad() {
    // joy�µ�Game���
    this._joyCom = this.node.parent.getComponent('joystick'); // game����µ�player�ڵ�

    this._playerNode = this._joyCom.sprite;

    if (this._joyCom.touchType == Common.TouchType.DEFAULT) {
      //��ԲȦ�Ĵ�������
      this._initTouchEvent();
    }
  },
  //��ԲȦ�Ĵ�������
  _initTouchEvent: function _initTouchEvent() {
    var self = this;
    self.node.on(cc.Node.EventType.TOUCH_START, this._touchStartEvent, self);
    self.node.on(cc.Node.EventType.TOUCH_MOVE, this._touchMoveEvent, self); // ������ԲȦ���뿪����ԲȦ���뿪��ҡ�˹�λ��player�ٶ�Ϊ0

    self.node.on(cc.Node.EventType.TOUCH_END, this._touchEndEvent, self);
    self.node.on(cc.Node.EventType.TOUCH_CANCEL, this._touchEndEvent, self);
  },
  //�����ƶ�Ŀ��
  update: function update(dt) {
    switch (this._joyCom.directionType) {
      case Common.DirectionType.ALL:
        this._allDirectionsMove();

        break;

      default:
        break;
    }
  },
  //ȫ�����ƶ�
  _allDirectionsMove: function _allDirectionsMove() {
    this._playerNode.x += Math.cos(this._angle * (Math.PI / 180)) * this._speed;
    this._playerNode.y += Math.sin(this._angle * (Math.PI / 180)) * this._speed;
  },
  //���������ľ��벢����
  _getDistance: function _getDistance(pos1, pos2) {
    return Math.sqrt(Math.pow(pos1.x - pos2.x, 2) + Math.pow(pos1.y - pos2.y, 2));
  },

  /*�Ƕ�/����ת��
  �Ƕ� = ���� * 180 / Math.PI
  ���� = �Ƕ� * Math.PI / 180*/
  //���㻡�Ȳ�����
  _getRadian: function _getRadian(point) {
    this._radian = Math.PI / 180 * this._getAngle(point);
    return this._radian;
  },
  //����ǶȲ�����
  _getAngle: function _getAngle(point) {
    var pos = this.node.getPosition();
    this._angle = Math.atan2(point.y - pos.y, point.x - pos.x) * (180 / Math.PI);
    return this._angle;
  },
  //����ʵ���ٶ�
  _setSpeed: function _setSpeed(point) {
    //�������ң�ظ����ĵľ���
    var distance = this._getDistance(point, this.node.getPosition()); //����뾶


    if (distance < this._radius) {
      this._speed = this._speed1;
    } else {
      this._speed = this._speed2;
    }
  },
  _touchStartEvent: function _touchStartEvent(event) {
    // ��ȡ����λ�õ���������ת����ԲȦ��������꣨��ԲȦ��ê��Ϊ��׼��
    var touchPos = this.node.convertToNodeSpaceAR(event.getLocation()); //��������ԲȦ���ĵľ���

    var distance = this._getDistance(touchPos, cc.Vec2(0, 0)); //ԲȦ�뾶


    var radius = this.node.width / 2; // ��¼ҡ��λ�ã���touch moveʹ��

    this._stickPos = touchPos;
    var posX = this.node.getPosition().x + touchPos.x;
    var posY = this.node.getPosition().y + touchPos.y; //��ָ��ԲȦ�ڴ���,�ظ˸��津����

    if (radius > distance) {
      this.dot.setPosition(cc.Vec2(posX, posY));
      return true;
    }

    return false;
  },
  _touchMoveEvent: function _touchMoveEvent(event) {
    var touchPos = this.node.convertToNodeSpaceAR(event.getLocation());

    var distance = this._getDistance(touchPos, cc.Vec2(0, 0));

    var radius = this.node.width / 2; // ����ҡ�˵�postion���Ը��ڵ�Ϊê�㣬���Զ�λҪ����ring��dot��ǰ��λ��(stickX,stickY)

    var posX = this.node.getPosition().x + touchPos.x;
    var posY = this.node.getPosition().y + touchPos.y;

    if (radius > distance) {
      this.dot.setPosition(cc.Vec2(posX, posY));
    } else {
      //�ظ���Զ������Ȧ�ڣ�����Ȧ�ڸ��津�����½Ƕ�
      var x = this.node.getPosition().x + Math.cos(this._getRadian(cc.Vec2(posX, posY))) * radius;
      var y = this.node.getPosition().y + Math.sin(this._getRadian(cc.Vec2(posX, posY))) * radius;
      this.dot.setPosition(cc.Vec2(x, y));
    } //���½Ƕ�


    this._getAngle(cc.Vec2(posX, posY)); //����ʵ���ٶ�


    this._setSpeed(cc.Vec2(posX, posY));
  },
  _touchEndEvent: function _touchEndEvent() {
    this.dot.setPosition(this.node.getPosition());
    this._speed = 0;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NpcHRzXFxqb3lzdGlja2JnLmpzIl0sIm5hbWVzIjpbIkNvbW1vbiIsInJlcXVpcmUiLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImRvdCIsInR5cGUiLCJOb2RlIiwiZGlzcGxheU5hbWUiLCJfam95Q29tIiwiX3BsYXllck5vZGUiLCJfYW5nbGUiLCJfcmFkaWFuIiwiX3NwZWVkIiwiX3NwZWVkMSIsIl9zcGVlZDIiLCJfb3BhY2l0eSIsIm9uTG9hZCIsIm5vZGUiLCJwYXJlbnQiLCJnZXRDb21wb25lbnQiLCJzcHJpdGUiLCJ0b3VjaFR5cGUiLCJUb3VjaFR5cGUiLCJERUZBVUxUIiwiX2luaXRUb3VjaEV2ZW50Iiwic2VsZiIsIm9uIiwiRXZlbnRUeXBlIiwiVE9VQ0hfU1RBUlQiLCJfdG91Y2hTdGFydEV2ZW50IiwiVE9VQ0hfTU9WRSIsIl90b3VjaE1vdmVFdmVudCIsIlRPVUNIX0VORCIsIl90b3VjaEVuZEV2ZW50IiwiVE9VQ0hfQ0FOQ0VMIiwidXBkYXRlIiwiZHQiLCJkaXJlY3Rpb25UeXBlIiwiRGlyZWN0aW9uVHlwZSIsIkFMTCIsIl9hbGxEaXJlY3Rpb25zTW92ZSIsIngiLCJNYXRoIiwiY29zIiwiUEkiLCJ5Iiwic2luIiwiX2dldERpc3RhbmNlIiwicG9zMSIsInBvczIiLCJzcXJ0IiwicG93IiwiX2dldFJhZGlhbiIsInBvaW50IiwiX2dldEFuZ2xlIiwicG9zIiwiZ2V0UG9zaXRpb24iLCJhdGFuMiIsIl9zZXRTcGVlZCIsImRpc3RhbmNlIiwiX3JhZGl1cyIsImV2ZW50IiwidG91Y2hQb3MiLCJjb252ZXJ0VG9Ob2RlU3BhY2VBUiIsImdldExvY2F0aW9uIiwiVmVjMiIsInJhZGl1cyIsIndpZHRoIiwiX3N0aWNrUG9zIiwicG9zWCIsInBvc1kiLCJzZXRQb3NpdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxnQkFB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SSxHQUFMLENBQVMsS0FBS00sVUFBTCxDQUFnQnBELEVBQUUsQ0FBQ2lFLElBQUgsQ0FBUUksSUFBUixFQUFhQyxJQUFiLENBQWhCLENBQVQsSUFBZ0RKLE1BQXBGO0FBQ0EsV0FBSzlELEdBQUwsQ0FBU21FLFdBQVQsQ0FBcUJ2RSxFQUFFLENBQUNpRSxJQUFILENBQVF4QixDQUFSLEVBQVdJLENBQVgsQ0FBckI7QUFDSCxLQWpCMkIsQ0FrQjVCOzs7QUFDQSxTQUFLUyxTQUFMLENBQWV0RCxFQUFFLENBQUNpRSxJQUFILENBQVFJLElBQVIsRUFBYUMsSUFBYixDQUFmLEVBbkI0QixDQW9CNUI7OztBQUNBLFNBQUtaLFNBQUwsQ0FBZTFELEVBQUUsQ0FBQ2lFLElBQUgsQ0FBUUksSUFBUixFQUFhQyxJQUFiLENBQWY7QUFFSCxHQS9LSTtBQWlMTHJDLEVBQUFBLGNBQWMsRUFBRSwwQkFBVTtBQUN0QixTQUFLN0IsR0FBTCxDQUFTbUUsV0FBVCxDQUFxQixLQUFLdEQsSUFBTCxDQUFVdUMsV0FBVixFQUFyQjtBQUNBLFNBQUs1QyxNQUFMLEdBQWMsQ0FBZDtBQUNIO0FBcExJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBDb21tb24gPSByZXF1aXJlKCdqb3lzdGlja2NvbW1vbicpO1xyXG5cclxuY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG5cclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICBkb3Q6IHtcclxuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcclxuICAgICAgICAgICAgdHlwZTogY2MuTm9kZSxcclxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdkb3QnLFxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIF9qb3lDb206IHtcclxuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcclxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdqb3kgTm9kZScsXHJcblxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgX3BsYXllck5vZGU6IHtcclxuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcclxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICfvv73vv73vv73vv73vv73vv73vv73vv73Ev++/ve+/vU5vZGUnLFxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIF9hbmdsZToge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxyXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ++/ve+/vcew77+977+977+977+977+9xL3Htu+/vScsXHJcblxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIF9yYWRpYW46IHtcclxuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcclxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICfvv73vv73vv73vv70nLFxyXG4gICAgICAgIH0sXHJcblxyXG5cclxuICAgICAgICBfc3BlZWQ6IDAsICAgICAgICAgIC8vyrXvv73vv73vv73Ztu+/vVxyXG4gICAgICAgIF9zcGVlZDE6IDEsICAgICAgICAgLy/Su++/ve+/ve+/vdm277+9XHJcbiAgICAgICAgX3NwZWVkMjogMiwgICAgICAgICAvL++/ve+/ve+/ve+/ve+/vdm277+9XHJcbiAgICAgICAgX29wYWNpdHk6IDAsICAgICAgICAvL82477+977+977+977+9XHJcbiAgICB9LFxyXG5cclxuXHJcbiAgICBvbkxvYWQ6IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBqb3nvv73Cte+/vUdhbWXvv73vv73vv71cclxuICAgICAgICB0aGlzLl9qb3lDb20gPSB0aGlzLm5vZGUucGFyZW50LmdldENvbXBvbmVudCgnam95c3RpY2snKTtcclxuXHJcblxyXG4gICAgICAgIC8vIGdhbWXvv73vv73vv73vv73Cte+/vXBsYXllcu+/vdq177+9XHJcbiAgICAgICAgdGhpcy5fcGxheWVyTm9kZSA9IHRoaXMuX2pveUNvbS5zcHJpdGU7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX2pveUNvbS50b3VjaFR5cGUgPT0gQ29tbW9uLlRvdWNoVHlwZS5ERUZBVUxUKXtcclxuICAgICAgICAgICAgLy/vv73vv73Ussim77+9xLTvv73vv73vv73vv73vv73vv73vv71cclxuICAgICAgICAgICAgdGhpcy5faW5pdFRvdWNoRXZlbnQoKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuXHJcbiAgICAvL++/ve+/vdSyyKbvv73EtO+/ve+/ve+/ve+/ve+/ve+/ve+/vVxyXG4gICAgX2luaXRUb3VjaEV2ZW50OiBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBzZWxmLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfU1RBUlQsIHRoaXMuX3RvdWNoU3RhcnRFdmVudCwgc2VsZik7XHJcblxyXG4gICAgICAgIHNlbGYubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9NT1ZFLCB0aGlzLl90b3VjaE1vdmVFdmVudCwgc2VsZik7XHJcblxyXG4gICAgICAgIC8vIO+/ve+/ve+/ve+/ve+/ve+/vdSyyKbvv73vv73vv73rv6rvv73vv73vv73vv73Ussim77+977+977+967+q77+977+90qHvv73Lue+/vc6777+977+9cGxheWVy77+92bbvv73OqjBcclxuICAgICAgICBzZWxmLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfRU5ELCB0aGlzLl90b3VjaEVuZEV2ZW50LCBzZWxmKTtcclxuICAgICAgICBzZWxmLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfQ0FOQ0VMLCB0aGlzLl90b3VjaEVuZEV2ZW50LCBzZWxmKTtcclxuICAgIH0sXHJcblxyXG4gICAgLy/vv73vv73vv73vv73vv73Gtu+/vcS/77+977+9XHJcbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGR0KVxyXG4gICAge1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5fam95Q29tLmRpcmVjdGlvblR5cGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjYXNlIENvbW1vbi5EaXJlY3Rpb25UeXBlLkFMTDpcclxuICAgICAgICAgICAgICAgIHRoaXMuX2FsbERpcmVjdGlvbnNNb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdCA6XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgIC8vyKvvv73vv73vv73vv73vv73Gtu+/vVxyXG4gICAgX2FsbERpcmVjdGlvbnNNb3ZlOiBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5fcGxheWVyTm9kZS54ICs9IE1hdGguY29zKHRoaXMuX2FuZ2xlICogKE1hdGguUEkvMTgwKSkgKiB0aGlzLl9zcGVlZDtcclxuICAgICAgICB0aGlzLl9wbGF5ZXJOb2RlLnkgKz0gTWF0aC5zaW4odGhpcy5fYW5nbGUgKiAoTWF0aC5QSS8xODApKSAqIHRoaXMuX3NwZWVkO1xyXG5cclxuICAgIH0sXHJcblxyXG4gICAgIC8v77+977+977+977+977+977+977+977+977+9xL7vv73vv73rsqLvv73vv73vv73vv71cclxuICAgIF9nZXREaXN0YW5jZTogZnVuY3Rpb24ocG9zMSwgcG9zMilcclxuICAgIHtcclxuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KE1hdGgucG93KHBvczEueCAtIHBvczIueCwgMikgK1xyXG4gICAgICAgIE1hdGgucG93KHBvczEueSAtIHBvczIueSwgMikpO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKu+/vce277+9L++/ve+/ve+/ve+/vdeq77+977+9XHJcbiAgICDvv73Htu+/vSA9IO+/ve+/ve+/ve+/vSAqIDE4MCAvIE1hdGguUElcclxuICAgIO+/ve+/ve+/ve+/vSA9IO+/vce277+9ICogTWF0aC5QSSAvIDE4MCovXHJcbiAgICAvL++/ve+/ve+/veO7oe+/vciy77+977+977+977+977+9XHJcbiAgICBfZ2V0UmFkaWFuOiBmdW5jdGlvbihwb2ludClcclxuICAgIHtcclxuICAgICAgICB0aGlzLl9yYWRpYW4gPSBNYXRoLlBJIC8gMTgwICogdGhpcy5fZ2V0QW5nbGUocG9pbnQpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9yYWRpYW47XHJcbiAgICB9LFxyXG5cclxuICAgIC8v77+977+977+977+9x7bIsu+/ve+/ve+/ve+/ve+/vVxyXG4gICAgX2dldEFuZ2xlOiBmdW5jdGlvbihwb2ludClcclxuICAgIHtcclxuXHJcbiAgICAgICAgdmFyIHBvcyA9IHRoaXMubm9kZS5nZXRQb3NpdGlvbigpO1xyXG4gICAgICAgIHRoaXMuX2FuZ2xlID0gTWF0aC5hdGFuMihwb2ludC55IC0gcG9zLnksIHBvaW50LnggLSBwb3MueCkgKiAoMTgwL01hdGguUEkpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9hbmdsZTtcclxuICAgIH0sXHJcblxyXG4gICAgIC8v77+977+977+977+9yrXvv73vv73vv73Ztu+/vVxyXG4gICAgX3NldFNwZWVkOiBmdW5jdGlvbihwb2ludClcclxuICAgIHtcclxuICAgICAgICAvL++/ve+/ve+/ve+/ve+/ve+/ve+/vdKj77+92Ljvv73vv73vv73vv73EtcS+77+977+977+9XHJcbiAgICAgICAgdmFyIGRpc3RhbmNlID0gdGhpcy5fZ2V0RGlzdGFuY2UocG9pbnQsIHRoaXMubm9kZS5nZXRQb3NpdGlvbigpKTtcclxuXHJcbiAgICAgICAgLy/vv73vv73vv73vv73rvrZcclxuICAgICAgICBpZihkaXN0YW5jZSA8IHRoaXMuX3JhZGl1cylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NwZWVkID0gdGhpcy5fc3BlZWQxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9zcGVlZCA9IHRoaXMuX3NwZWVkMjtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIF90b3VjaFN0YXJ0RXZlbnQ6IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgLy8g77+977+9yKHvv73vv73vv73vv73Ou++/vcO177+977+977+977+977+977+977+977+977+916rvv73vv73vv73vv73Ussim77+977+977+977+977+977+977+977+96qOo77+977+91LLIpu+/ve+/vcOq77+977+9zqrvv73vv73XvO+/ve+/vVxyXG4gICAgICAgIHZhciB0b3VjaFBvcyA9IHRoaXMubm9kZS5jb252ZXJ0VG9Ob2RlU3BhY2VBUihldmVudC5nZXRMb2NhdGlvbigpKTtcclxuICAgICAgICAvL++/ve+/ve+/ve+/ve+/ve+/ve+/ve+/vdSyyKbvv73vv73vv73EtcS+77+977+977+9XHJcbiAgICAgICAgdmFyIGRpc3RhbmNlID0gdGhpcy5fZ2V0RGlzdGFuY2UodG91Y2hQb3MsY2MuVmVjMigwLDApKTtcclxuICAgICAgICAvL9SyyKbvv73rvrZcclxuICAgICAgICB2YXIgcmFkaXVzID0gdGhpcy5ub2RlLndpZHRoIC8gMjtcclxuICAgICAgICAvLyDvv73vv73CvNKh77+977+9zrvvv73Do++/ve+/ve+/vXRvdWNoIG1vdmXKue+/ve+/vVxyXG4gICAgICAgIHRoaXMuX3N0aWNrUG9zID0gdG91Y2hQb3M7XHJcbiAgICAgICAgdmFyIHBvc1ggPSB0aGlzLm5vZGUuZ2V0UG9zaXRpb24oKS54ICsgdG91Y2hQb3MueDtcclxuICAgICAgICB2YXIgcG9zWSA9IHRoaXMubm9kZS5nZXRQb3NpdGlvbigpLnkgKyB0b3VjaFBvcy55O1xyXG4gICAgICAgICAvL++/ve+/vda477+977+91LLIpu+/vdq077+977+977+9LO+/vdi4y7jvv73vv73mtKXvv73vv73vv73vv71cclxuICAgICAgICBpZihyYWRpdXMgPiBkaXN0YW5jZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuZG90LnNldFBvc2l0aW9uKGNjLlZlYzIocG9zWCwgcG9zWSkpO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSxcclxuXHJcbiAgICBfdG91Y2hNb3ZlRXZlbnQ6IGZ1bmN0aW9uKGV2ZW50KXtcclxuICAgICAgICB2YXIgdG91Y2hQb3MgPSB0aGlzLm5vZGUuY29udmVydFRvTm9kZVNwYWNlQVIoZXZlbnQuZ2V0TG9jYXRpb24oKSk7XHJcbiAgICAgICAgdmFyIGRpc3RhbmNlID0gdGhpcy5fZ2V0RGlzdGFuY2UodG91Y2hQb3MsY2MuVmVjMigwLDApKTtcclxuICAgICAgICB2YXIgcmFkaXVzID0gdGhpcy5ub2RlLndpZHRoIC8gMjtcclxuICAgICAgICAvLyDvv73vv73vv73vv73Soe+/vcu177+9cG9zdGlvbu+/ve+/ve+/vdS477+977+92rXvv73OqsOq77+946Os77+977+977+91Lbvv73Ou9Kq77+977+977+977+9cmluZ++/ve+/vWRvdO+/ve+/vcew77+977+9zrvvv73vv70oc3RpY2tYLHN0aWNrWSlcclxuICAgICAgICB2YXIgcG9zWCA9IHRoaXMubm9kZS5nZXRQb3NpdGlvbigpLnggKyB0b3VjaFBvcy54O1xyXG4gICAgICAgIHZhciBwb3NZID0gdGhpcy5ub2RlLmdldFBvc2l0aW9uKCkueSArIHRvdWNoUG9zLnk7XHJcbiAgICAgICAgaWYocmFkaXVzID4gZGlzdGFuY2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLmRvdC5zZXRQb3NpdGlvbihjYy5WZWMyKHBvc1gsIHBvc1kpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy/vv73YuO+/ve+/ve+/vdS277+977+977+977+977+977+9yKbvv73ao++/ve+/ve+/ve+/ve+/vcim77+92rjvv73vv73mtKXvv73vv73vv73vv73vv73Cvce277+9XHJcbiAgICAgICAgICAgIHZhciB4ID0gdGhpcy5ub2RlLmdldFBvc2l0aW9uKCkueCArIE1hdGguY29zKHRoaXMuX2dldFJhZGlhbihjYy5WZWMyKHBvc1gscG9zWSkpKSAqIHJhZGl1cztcclxuICAgICAgICAgICAgdmFyIHkgPSB0aGlzLm5vZGUuZ2V0UG9zaXRpb24oKS55ICsgTWF0aC5zaW4odGhpcy5fZ2V0UmFkaWFuKGNjLlZlYzIocG9zWCxwb3NZKSkpICogcmFkaXVzO1xyXG4gICAgICAgICAgICB0aGlzLmRvdC5zZXRQb3NpdGlvbihjYy5WZWMyKHgsIHkpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy/vv73vv73vv73Cvce277+9XHJcbiAgICAgICAgdGhpcy5fZ2V0QW5nbGUoY2MuVmVjMihwb3NYLHBvc1kpKTtcclxuICAgICAgICAvL++/ve+/ve+/ve+/vcq177+977+977+92bbvv71cclxuICAgICAgICB0aGlzLl9zZXRTcGVlZChjYy5WZWMyKHBvc1gscG9zWSkpO1xyXG5cclxuICAgIH0sXHJcblxyXG4gICAgX3RvdWNoRW5kRXZlbnQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdGhpcy5kb3Quc2V0UG9zaXRpb24odGhpcy5ub2RlLmdldFBvc2l0aW9uKCkpO1xyXG4gICAgICAgIHRoaXMuX3NwZWVkID0gMDtcclxuICAgIH0sXHJcbn0pO1xyXG4iXX0=